import requests
import base64
import string
from requests.auth import HTTPBasicAuth
from bs4 import BeautifulSoup


url = 'http://natas8.natas.labs.overthewire.org/index-source.html'
auth_data = HTTPBasicAuth('natas8', 'DBfUBfqQG69KvJvJ1iAbMoIpwSNQ9bWe')
r = requests.post(url, auth = auth_data)

print('[*] Status code: ' + str(r.status_code))
soup = BeautifulSoup(r.content, 'html.parser')
html_string = soup.prettify().replace('<br/>', '')
print("[*] Sourcecode: " + str(html_string))

"""
# This is the php code of the page.

$encodedSecret = "3d3d516343746d4d6d6c315669563362";
function encodeSecret($secret) {
  return bin2hex(strrev(base64_encode($secret)));
}
  
if(array_key_exists("submit", $_POST)) {
    if(encodeSecret($_POST['secret']) == $encodedSecret) {
        print "Access granted. The password for natas9 is &lt;censored&gt;";
    } 
    else {
        print "Wrong secret";
    }
}
"""

encoded_secret = '3d3d516343746d4d6d6c315669563362'

# We need to work backwards.
encoded_secret = bytes.fromhex(encoded_secret)
encoded_secret = encoded_secret[::-1]
decoded_secret = base64.b64decode(encoded_secret)

print('[*] Decoded secret: ' + str(decoded_secret)) # oubWYf2kBq.

# Then submitting the decoded 'oubWYf2kBq' string, access is granted.

